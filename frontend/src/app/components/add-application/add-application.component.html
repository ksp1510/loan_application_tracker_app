<!-- src/app/components/add-application/add-application.component.html -->
<form [formGroup]="applicationForm" (ngSubmit)="onSubmit()" class="application-form" fxLayout="column" fxLayoutGap="24px">
  <div fxLayout="row wrap" fxLayoutGap="24px">
    <mat-card fxFlex="100">
      <mat-card-title>Loan Application Details</mat-card-title>
      <mat-card-content fxLayout="row wrap" fxLayoutGap="24px">
        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Requested Loan Amount</mat-label>
          <input matInput type="number" formControlName="amount">
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Security</mat-label>
          <mat-select formControlName="security">
            <mat-option *ngFor="let sec of securities" [value]="sec">{{ sec }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Status</mat-label>
          <mat-select formControlName="status">
            <mat-option *ngFor="let s of applicationStatuses" [value]="s">{{ s }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="35">
          <mat-label>Notes</mat-label>
          <textarea matInput formControlName="notes" rows="3"></textarea>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

      
  <mat-card fxFlex="100">
    <mat-card-title>Main Applicant</mat-card-title>
    <mat-card-content fxLayout="row wrap" fxLayoutGap="24px" formGroupName="main_applicant">
      <div formGroupName="main_applicant">
        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>First Name</mat-label>
          <input matInput formControlName="first_name" required>
          <mat-error *ngIf="applicationForm.get('main_applicant.first_name')?.hasError('required')">
            First name is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Middle Name</mat-label>
          <input matInput formControlName="middle_name">
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Last Name</mat-label>
          <input matInput formControlName="last_name" required>
          <mat-error *ngIf="applicationForm.get('main_applicant.last_name')?.hasError('required')">
            Last name is required
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Date of Birth</mat-label>
          <input matInput [matDatepicker]="dobPicker" formControlName="date_of_birth" required>
          <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
          <mat-datepicker #dobPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>SIN</mat-label>
          <input matInput formControlName="SIN" required>
          <mat-error *ngIf="applicationForm.get('main_applicant.SIN')?.hasError('required')">
            SIN is required
          </mat-error>
        </mat-form-field>

        <div formGroupName="address">
          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Street</mat-label>
            <input matInput formControlName="street" required>
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>City</mat-label>
            <input matInput formControlName="city" required>
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Province</mat-label>
            <mat-select formControlName="province" required>
              <mat-option *ngFor="let p of provinces" [value]="p">{{ p }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Postal Code</mat-label>
            <input matInput formControlName="postal_code" required>
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Duration at Address (months)</mat-label>
          <input matInput type="number" formControlName="duration_at_address">
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Rent</mat-label>
          <input matInput type="number" formControlName="rent">
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Cell Phone</mat-label>
          <input matInput formControlName="cell_phone" required>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" required>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Marital Status</mat-label>
          <mat-select formControlName="marital_status" required>
            <mat-option *ngFor="let m of maritalStatuses" [value]="m">{{ m }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Dependents</mat-label>
          <input matInput type="number" formControlName="dependents">
        </mat-form-field>

        <mat-form-field appearance="outline" fxFlex="20">
          <mat-label>Status in Canada</mat-label>
          <mat-select formControlName="status_in_canada" required>
            <mat-option *ngFor="let s of statusesInCanada" [value]="s">{{ s }}</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Employment -->
        <div formGroupName="ft_employment">
          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Company Name</mat-label>
            <input matInput formControlName="company_name">
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Position</mat-label>
            <input matInput formControlName="position">
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Length of Service</mat-label>
            <input matInput type="number" formControlName="length_of_service">
          </mat-form-field>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Gross Income</mat-label>
            <input matInput type="number" formControlName="gross_income">
          </mat-form-field>

          <div formGroupName="company_address">
            <mat-form-field appearance="outline" fxFlex="20">
              <mat-label>Street</mat-label>
              <input matInput formControlName="street">
            </mat-form-field>

            <mat-form-field appearance="outline" fxFlex="20">
              <mat-label>City</mat-label>
              <input matInput formControlName="city">
            </mat-form-field>

            <mat-form-field appearance="outline" fxFlex="20">
              <mat-label>Province</mat-label>
              <mat-select formControlName="province">
                <mat-option *ngFor="let p of provinces" [value]="p">{{ p }}</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" fxFlex="20">
              <mat-label>Postal Code</mat-label>
              <input matInput formControlName="postal_code">
            </mat-form-field>
          </div>

          <mat-form-field appearance="outline" fxFlex="20">
            <mat-label>Company Phone</mat-label>
            <input matInput formControlName="company_phone">
          </mat-form-field>
        </div>

        <!-- Additional sections like vehicle, monthly income, monthly expenses and loan can be added in the same structured way -->
         <mat-card fxFlex="100">
            <mat-card-title>Vehicles</mat-card-title>
            <mat-card-content>
            <div formGroupName="vehicle1">
                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Year</mat-label>
                <mat-select formControlName="year">
                    <mat-option *ngFor="let y of vehicleYears" [value]="y">{{ y }}</mat-option>
                </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Make</mat-label>
                <mat-select formControlName="make">
                    <mat-option *ngFor="let m of vehicleMakes" [value]="m">{{ m }}</mat-option>
                </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Model</mat-label>
                <input matInput formControlName="model">
                </mat-form-field>
            </div>
            </mat-card-content>
        </mat-card>

        <mat-card fxFlex="100">
            <mat-card-title>Monthly Expenses</mat-card-title>
            <mat-card-content>
            <div formGroupName="monthly_expenses">
                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Utilities</mat-label>
                <input matInput type="number" formControlName="utilities">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Property Taxes</mat-label>
                <input matInput type="number" formControlName="property_taxes">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Child Support</mat-label>
                <input matInput type="number" formControlName="child_support">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Groceries</mat-label>
                <input matInput type="number" formControlName="groceries">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Car Insurance</mat-label>
                <input matInput type="number" formControlName="car_insurence">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Car Payment</mat-label>
                <input matInput type="number" formControlName="car_payment">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Phone Bill</mat-label>
                <input matInput type="number" formControlName="phone_bill">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Internet</mat-label>
                <input matInput type="number" formControlName="internet">
                </mat-form-field>

                <mat-form-field appearance="outline" disabled fxFlex="20">
                <mat-label>Total Expenses</mat-label>
                <input matInput [value]="totalExpenses" readonly>
                </mat-form-field>
            </div>
            </mat-card-content>
        </mat-card>

        <mat-card fxFlex="100">
            <mat-card-title>Monthly Income</mat-card-title>
            <mat-card-content>
                <div formGroupName="monthly_income">
                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Full-Time Income</mat-label>
                    <input matInput type="number" formControlName="ft_income">
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Part-Time Income</mat-label>
                    <input matInput type="number" formControlName="pt_income">
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Child Tax</mat-label>
                    <input matInput type="number" formControlName="child_tax">
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Government Support</mat-label>
                    <input matInput type="number" formControlName="govt_support">
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Pension</mat-label>
                    <input matInput type="number" formControlName="pension">
                    </mat-form-field>

                    <mat-form-field appearance="outline" disabled fxFlex="20">
                    <mat-label>Total Income</mat-label>
                    <input matInput [value]="totalIncome" readonly>
                    </mat-form-field>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card fxFlex="100">
            <mat-card-title>Loans</mat-card-title>
            <mat-card-content>
            <div formArrayName="loan">
                <div *ngFor="let loan of loanFormArray.controls; let i = index" [formGroupName]="i">
                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Financial Institution</mat-label>
                    <input matInput formControlName="financial_institution">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Monthly Payment</mat-label>
                    <input matInput type="number" formControlName="monthly_pymnt">
                </mat-form-field>
                </div>
                <button mat-stroked-button color="accent" (click)="addLoan()" type="button">Add Loan</button>
            </div>
            </mat-card-content>
        </mat-card>

        <mat-card fxFlex="100">
            <mat-card-title>
            Co-Applicant
            <mat-slide-toggle formControlName="hasCoApplicant">Include Co-Applicant</mat-slide-toggle>
            </mat-card-title>
            <mat-card-content *ngIf="applicationForm.get('hasCoApplicant')?.value">
            <div formGroupName="co_applicant">
                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>First Name</mat-label>
                    <input matInput formControlName="first_name">
                </mat-form-field>
                
                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Middle Name</mat-label>
                    <input matInput formControlName="middle_name">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Last Name</mat-label>
                    <input matInput formControlName="last_name">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Date of Birth</mat-label>
                    <input matInput [matDatepicker]="dobPicker" formControlName="date_of_birth">
                    <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
                    <mat-datepicker #dobPicker></mat-datepicker>
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>SIN</mat-label>
                    <input matInput formControlName="SIN">
                </mat-form-field>

                <div formGroupName="address">
                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Street</mat-label>
                    <input matInput formControlName="street">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>City</mat-label>
                    <input matInput formControlName="city">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Province</mat-label>
                    <mat-select formControlName="province">
                    <mat-option *ngFor="let p of provinces" [value]="p">{{ p }}</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Postal Code</mat-label>
                    <input matInput formControlName="postal_code">
                </mat-form-field>
                </div>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Duration at Address (months)</mat-label>
                    <input matInput type="number" formControlName="duration_at_address">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Rent</mat-label>
                    <input matInput type="number" formControlName="rent">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Cell Phone</mat-label>
                    <input matInput formControlName="cell_phone">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Email</mat-label>
                    <input matInput formControlName="email">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Marital Status</mat-label>
                <mat-select formControlName="marital_status">
                    <mat-option *ngFor="let m of maritalStatuses" [value]="m">{{ m }}</mat-option>
                </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Dependents</mat-label>
                <input matInput type="number" formControlName="dependents">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                <mat-label>Status in Canada</mat-label>
                <mat-select formControlName="status_in_canada">
                    <mat-option *ngFor="let s of statusesInCanada" [value]="s">{{ s }}</mat-option>
                </mat-select>
                </mat-form-field>

                <!-- Employment -->
                <div formGroupName="ft_employment">
                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Company Name</mat-label>
                    <input matInput formControlName="company_name">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Position</mat-label>
                    <input matInput formControlName="position">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Length of Service</mat-label>
                    <input matInput type="number" formControlName="length_of_service">
                </mat-form-field>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Gross Income</mat-label>
                    <input matInput type="number" formControlName="gross_income">
                </mat-form-field>

                <div formGroupName="company_address">
                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Street</mat-label>
                    <input matInput formControlName="street">
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>City</mat-label>
                    <input matInput formControlName="city">
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Province</mat-label>
                    <mat-select formControlName="province">
                        <mat-option *ngFor="let p of provinces" [value]="p">{{ p }}</mat-option>
                    </mat-select>
                    </mat-form-field>

                    <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Postal Code</mat-label>
                    <input matInput formControlName="postal_code">
                    </mat-form-field>
                </div>

                <mat-form-field appearance="outline" fxFlex="20">
                    <mat-label>Company Phone</mat-label>
                    <input matInput formControlName="company_phone">
                </mat-form-field>
                </div>

                <!-- Additional sections like vehicle, monthly income, monthly expenses and loan can be added in the same structured way -->
                <mat-card fxFlex="100">
                    <mat-card-title>Vehicles</mat-card-title>
                    <mat-card-content>
                    <div formGroupName="vehicle1">
                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Year</mat-label>
                        <mat-select formControlName="year">
                            <mat-option *ngFor="let y of vehicleYears" [value]="y">{{ y }}</mat-option>
                        </mat-select>
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20"  >
                        <mat-label>Make</mat-label>
                        <mat-select formControlName="make">
                            <mat-option *ngFor="let m of vehicleMakes" [value]="m">{{ m }}</mat-option>
                        </mat-select>
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20"  >
                        <mat-label>Model</mat-label>
                        <input matInput formControlName="model">
                        </mat-form-field>
                    </div>
                    </mat-card-content>
                </mat-card>

                <mat-card fxFlex="100">
                    <mat-card-title>Monthly Expenses</mat-card-title>
                    <mat-card-content>
                    <div formGroupName="monthly_expenses">
                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Utilities</mat-label>
                        <input matInput type="number" formControlName="utilities">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Property Taxes</mat-label>
                        <input matInput type="number" formControlName="property_taxes">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Child Support</mat-label>
                        <input matInput type="number" formControlName="child_support">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Groceries</mat-label>
                        <input matInput type="number" formControlName="groceries">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Car Insurance</mat-label>
                        <input matInput type="number" formControlName="car_insurence">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Car Payment</mat-label>
                        <input matInput type="number" formControlName="car_payment">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Phone Bill</mat-label>
                        <input matInput type="number" formControlName="phone_bill">
                        </mat-form-field>

                        <mat-form-field appearance="outline" fxFlex="20">
                        <mat-label>Internet</mat-label>
                        <input matInput type="number" formControlName="internet">
                        </mat-form-field>

                        <mat-form-field appearance="outline" disabled>
                        <mat-label>Total Expenses</mat-label>
                        <input matInput [value]="totalExpenses" readonly>
                        </mat-form-field>
                    </div>
                    </mat-card-content>
                </mat-card>

                <mat-card fxFlex="100">
                    <mat-card-title>Monthly Income</mat-card-title>
                    <mat-card-content>
                        <div formGroupName="monthly_income">
                            <mat-form-field appearance="outline" fxFlex="20">
                            <mat-label>Full-Time Income</mat-label>
                            <input matInput type="number" formControlName="ft_income">
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="20">
                            <mat-label>Part-Time Income</mat-label>
                            <input matInput type="number" formControlName="pt_income">
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="20">
                            <mat-label>Child Tax</mat-label>
                            <input matInput type="number" formControlName="child_tax">
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="20">
                            <mat-label>Government Support</mat-label>
                            <input matInput type="number" formControlName="govt_support">
                            </mat-form-field>

                            <mat-form-field appearance="outline" fxFlex="20">
                            <mat-label>Pension</mat-label>
                            <input matInput type="number" formControlName="pension">
                            </mat-form-field>

                            <mat-form-field appearance="outline" disabled fxFlex="20">
                            <mat-label>Total Income</mat-label>
                            <input matInput [value]="totalIncome" readonly>
                            </mat-form-field>
                        </div>
                    </mat-card-content>
                </mat-card>

                <mat-card fxFlex="100">
                    <mat-card-title>Loans</mat-card-title>
                    <mat-card-content>
                    <div formArrayName="loan">
                        <div *ngFor="let loan of loanFormArray.controls; let i = index" [formGroupName]="i">
                        <mat-form-field appearance="outline"  fxFlex="20">
                            <mat-label>Financial Institution</mat-label>
                            <input matInput formControlName="financial_institution">
                        </mat-form-field>

                        <mat-form-field appearance="outline"  fxFlex="20">
                            <mat-label>Monthly Payment</mat-label>
                            <input matInput type="number" formControlName="monthly_pymnt">
                        </mat-form-field>
                        </div>
                        <button mat-stroked-button color="accent" (click)="addLoan()" type="button">Add Loan</button>
                    </div>
                    </mat-card-content>
                </mat-card>
                    </div>
                    </mat-card-content>
                </mat-card>



      </div>
    </mat-card-content>
  </mat-card>

  <div fxFlex="100" fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="16px">
      <button mat-raised-button color="primary" type="submit">Save</button>
      <button mat-stroked-button type="button" (click)="onCancel()">Cancel</button>
    </div>
  </div>
</form>
